<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <title></title>
    <style>
      svg {
        background-color: #eeeeee
      }
    </style>
  </head>
  <body>
    <div id="chart"></div>
  </body>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/5.15.0/d3.min.js"
          integrity="sha256-m0QmIsBXcOMiETRmpT3qg2IQ/i0qazJA2miCHzOmS1Y="
          crossorigin="anonymous">
  </script>
  <script type="text/javascript">

    const sampleData = [{ "name": "Switzerland", "value": 123876000 }, { "name": "Canada", "value": 20659235 }, { "name": "Singapore", "value": 17000000 }, { "name": "Turkey", "value": 10000000 }, { "name": "United States", "value": 5001003 }, { "name": "Belgium", "value": 3400393 }, { "name": "France", "value": 1050000 }, { "name": "Spain", "value": 396169 }, { "name": "Italy", "value": 18025 }, { "name": "India", "value": 1000 }, { "name": "United     Kingdom", "value": 3 }, { "name": "Korea, Republic of", "value": 0 }, { "name": "Norway", "value": 0 }, { "name": "Australia", "value": 0 }, { "name": "Saudi Arabia", "value": 0 }, { "name": "Ghana", "value": 0 }, {"name": "Other", "value": 100000000}]

    const newData = [{ "name": "Switzerland", "value": 123876000 }, { "name": "Canada", "value": 123876000 }, { "name": "Switzerland", "value": 123876000 }, { "name": "Canada", "value": 123876000 },{ "name": "Switzerland", "value": 123876000 }, { "name": "Canada", "value": 123876000 },{ "name": "Switzerland", "value": 123876000 }, { "name": "Canada", "value": 123876000 },{ "name": "Switzerland", "value": 123876000 }, { "name": "Canada", "value": 123876000 },]

    pieBar(sampleData.filter(x => x.value > 0), 'chart', {width: 500, height: 400} )

    function pieBar(data, containerId, options){
      const { width = 500,
        height = 400,
        maxRadius = 35,
        bubbleOpacity = 0.5,
        legendTextSize = 12
      } = options

      const svgPadding = width * 0.05
      const chartContainerWidth = width - 2*svgPadding
      const chartContainerHeight = height
      const topValue = data.reduce((a, x) => x.value < a ? a : x.value, 0)
      const minValue = data.reduce((a, x) => x.value > a ? a : x.value, 0)
      const numberScale = d3.scaleLinear().domain([0, topValue]).range([5, maxRadius])
      const colorScale = d3
        .scaleSequential()
        .domain([0, data.length])
        .interpolator(d3.interpolatePlasma)

      const svg = d3.select(`#${containerId}`)
        .append("svg")
        .attr("width", width)
        .attr("height", height)
        .attr('font-family', 'Arial')

      // Even spacing for bubbles
      const linearScale = d3.scaleLinear()
        .domain([0, data.length])
        .range([0, chartContainerWidth])

      const chartContainer =
        svg.append('g')
          .attr('id', 'chart-container')
          .attr('width', chartContainerWidth)
          .attr("transform", `translate(${maxRadius + svgPadding/2}, ${maxRadius + svgPadding/2})`)

      chartContainer
        .selectAll('.country-bubble')
        .data(data)
        .enter()
        .append('circle')
        .attr('class', `country-bubble`)
        .attr('id', (d,i) => `country-bubble-${i}`)
        .attr('r', d => numberScale(d.value))
        .attr('cx', (d, i) => linearScale(i))
        .attr('fill', (d, i) => colorScale(i))
        .attr('opacity', bubbleOpacity)

      const legendPadding = (height - (data.length * 20 + 5.5))/2
      const legendContainer =
        svg.append('g')
            .attr('id', 'legend-container')
            .attr('transform', `translate(${svgPadding}, ${legendPadding + maxRadius})`)

      legendContainer
        .selectAll('rect')
        .data(data)
        .enter()
        .append('rect')
        .attr('id', (d,i) => `legend-rect-${i}`)
        .attr('class', `legend-rect`)
        .attr('x', 0)
        .attr('y', (d,i) => i * 20 + 5.5)
        .attr('width', legendTextSize)
        .attr('height', legendTextSize)
        .attr('fill', (d, i) => colorScale(i))
        .attr('opacity', bubbleOpacity)

      legendContainer
        .selectAll('text')
        .data(data)
        .enter()
        .append('text')
        .attr('transform', `translate(5,0)`)
        .attr('id', (d,i) => `legend-text-${i}`)
        .attr('class', `legend-text`)
        .attr('y', (d,i) => 20 * i + 15)
        .attr('x', legendTextSize + 1)
        .text(d => `${d.name} ($${d.value.toLocaleString()})`)
        .style('font-family', 'Arial')
        .style('font-size', `${legendTextSize - 1 }px`)
        .on('mouseover', (d, i, paths) => {
          svg.select(`#country-bubble-${i}, #legend-text-${i}, #legend-rect-${i}`)
            .style('opacity', 1)
          d3.select(paths[i]).style('font-weight', 'bold')
        })
        .on('mouseout', (d, i, paths) => {
          svg.selectAll(`.country-bubble, .legend-rect`).style('opacity', bubbleOpacity)
          d3.select(paths[i]).style('font-weight', 'normal')
        })
    }
  </script>
</html>
